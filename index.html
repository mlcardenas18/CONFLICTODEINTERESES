<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Conflicto de intereses?</title> 
</head>
<body>
    <h1>Conflicto de intereses?</h1>
    
<script src="https://d3js.org/d3.v5.min.js"></script>
    
<svg  width=900  height=1000 id="redes" > </svg>

<script>
    //copy drag from: https://bl.ocks.org/msbostock/4062045
    //copy https://www.youtube.com/watch?v=OiRmMVsm3q8
    let svg = d3.select("#redes"),
        width= + svg.attr("width"),
        height= + svg.attr("height"),
        r = d3.scaleSqrt()
            .domain([0, 200])     
            .range([1, 50]);
    
    console.log("datosss1:",width, height); 
    
    let color = d3.scaleOrdinal(d3.schemeCategory10); /*escala de color utilizada para identificar los grupos Congresista - Familiar - Entidad_Contratante
    
    /*cargamos los datos*/
    
    d3.json("https://raw.githubusercontent.com/mlcardenas18/CONFLICTODEINTERESES/master/data/data_nodos.json").then(function(datagraf) {
       
    console.log("datosss:",width, height,datagraf);
    
        
    let simulation = d3.forceSimulation(datagraf.nodes)
      .force("center", d3.forceCenter(width/2,height/2))
      .force("charge", d3.forceManyBody().strength(-10)) /*se repelen los nodos*/
      .force("collide", d3.forceCollide(d => r(d.nro_contratos_familiares)+10)) /*colisión cúal es el radio de los que estoy colisionando*/
      .force("link", d3.forceLink(datagraf.links)
        .id((d) => d.nombre)
        .distance(30))
        .on("tick",ticked);
    
    console.log("nodes",datagraf.nodes);
    console.log("links",datagraf.links);
    
    let sellinks= svg.selectAll(".link")
    .data(datagraf.links)
    .enter()
    .append("line")
    .attr("class","link")
    .style("stroke", "steelblue")
    .style("opacity", 0.9)
    
    let selnodes= svg.selectAll(".node")
    .data(datagraf.nodes)
    .enter()
    .append("circle")
    .attr("class","node")
    .attr("cx", (d) => d.x)
    .attr("cy", (d) => d.y)
    .style("fill",function (d) { return color(d.grupo); })
    .attr("r",d => r(d.nro_contratos_familiares))
    .call(d3.drag()
         .on("start",dragstarted)
         .on("drag",dragended)
         .on("end",dragended));
    
    selnodes.append("title")
        .text( d => d.nombre);
      
    function ticked(){
         sellinks.attr("x1", (l) => l.source.x)
    .attr("y1", (l) => l.source.y)
    .attr("x2", (l) => l.target.x)
    .attr("y2", (l) => l.target.y);
        
        selnodes.attr("cx", (d) => d.x)
    .attr("cy", (d) => d.y);
    
    console.log("ticked!");        
        
    }
  
    function dragstarted(d) {
    if (!d3.event.active) simulation.alphaTarget(0.3).restart();
    d.fx = d.x;
    d.fy = d.y;
  }
  
  function dragged(d) {
    d.fx = d3.event.x;
    d.fy = d3.event.y;
  }
  
  function dragended(d) {
    if (!d3.event.active) simulation.alphaTarget(0);
    d.fx = null;
    d.fy = null;
  }
 });
    
</script>
</body>
</html>